{% extends "base.html" %}

{% block title %}Dashboard - Santos e Domingues Advocacia{% endblock %}

{% block content %}
{% if get_flashed_messages(with_categories=true) %}
<div class="flash-container">
    {% for category, message in get_flashed_messages(with_categories=true) %}
        <div class="flash {{ category }}">
            {{ message }}
            <span class="flash-close" onclick="this.parentElement.style.display='none';">&times;</span>
        </div>
    {% endfor %}
</div>
{% endif %}


<div class="dashboard-container">
    <h1>Bem-vindo, Dr(a). {{ session['user'] }}!</h1>
    <p>Este é o seu painel de controle.</p>

    <form action="{{ url_for('logout') }}" method="POST" style="margin-top:20px;">
        <button type="submit">Sair</button>
    </form>
</div>

<hr>

<div class="container">
    <h1>Análise de Exame</h1>

    <!-- Formulário de upload -->
    <form method="post" action="{{ url_for('exame_result') }}" enctype="multipart/form-data" class="upload-form" onsubmit="mostrarLoader()">
        <input type="file" name="file" accept="application/pdf" required>
        <button type="submit">Enviar</button>
    </form>

    <!-- Loader -->
    <div id="loader" class="loader-overlay" style="display: none;">
        <div class="loader"></div>
        <p>Processando análise, aguarde...</p>
    </div>

    <!-- Mensagens flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class="flashes">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <!-- Resultado da análise -->
    {% if valores %}
    <div class="result-card-valores">
      <h2>Valores fora do intervalo de referência:</h2>
      <ul>
        {% for v in valores %}
        <li>{{ v }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    
    {% if alteracoes %}
    <div class="result-card-alterados">
      <h2>Possíveis alterações clínicas:</h2>
      <ul>
        {% for a in alteracoes %}
        <li>{{ a }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    
    {% if diagnosticos %}
    <div class="result-card-diagnostico">
      <h2>Diagnósticos diferenciais (sugestões):</h2>
      <ul>
        {% for d in diagnosticos %}
        <li>{{ d }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
</div>



{% endblock %}
